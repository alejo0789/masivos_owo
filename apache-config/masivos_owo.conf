# Apache Configuration for Masivos OWO
# File: /etc/httpd/conf.d/masivos_owo.conf

<VirtualHost *:80>
    ServerName tu-dominio.com
    
    # Enable rewrite engine
    RewriteEngine On
    
    # WebSocket support for Next.js HMR (development)
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/masivos_owo/(.*)$ ws://192.168.2.91:3000/masivos_owo/$1 [P,L]
    
    # Proxy for Backend API (FastAPI on port 8001)
    # IMPORTANT: This must come BEFORE the frontend proxy
    ProxyPass /masivos_owo/api http://192.168.2.91:8001
    ProxyPassReverse /masivos_owo/api http://192.168.2.91:8001
    
    # Proxy for Next.js static files (_next directory)
    ProxyPass /masivos_owo/_next http://192.168.2.91:3000/masivos_owo/_next
    ProxyPassReverse /masivos_owo/_next http://192.168.2.91:3000/masivos_owo/_next
    
    # Proxy for Frontend (Next.js on port 3000)
    # This should be LAST to catch all other routes
    ProxyPass /masivos_owo http://192.168.2.91:3000/masivos_owo
    ProxyPassReverse /masivos_owo http://192.168.2.91:3000/masivos_owo
    
    # Preserve host header
    ProxyPreserveHost On
    
    # Proxy timeout settings
    ProxyTimeout 300
    
    # Additional proxy settings for better performance
    <Proxy *>
        Order deny,allow
        Allow from all
    </Proxy>
    
    # Logs
    ErrorLog /var/log/httpd/masivos_owo_error.log
    CustomLog /var/log/httpd/masivos_owo_access.log combined
</VirtualHost>

